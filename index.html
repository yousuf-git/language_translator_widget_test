<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Language Translator</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
        }
        h1 { color: #333; margin-bottom: 10px; }
        
        /* Status Bar */
        .status-bar {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-bar.detecting { background: #fff3e0; border-color: #ff9800; }
        .status-bar.error { background: #ffebee; border-color: #f44336; }
        .status-icon { font-size: 20px; }
        
        /* Language Selector */
        .language-selector { 
            margin: 20px 0; 
            padding: 20px; 
            background: #f5f5f5; 
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .language-selector label {
            font-weight: bold;
            font-size: 16px;
        }
        .language-selector select {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 6px;
            border: 2px solid #ddd;
            cursor: pointer;
            min-width: 200px;
        }
        .language-selector select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        /* Content Area */
        .content {
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin: 20px 0;
        }
        .content h2 { margin-top: 0; color: #333; }
        .translatable { line-height: 1.8; }
        
        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }
        .loading-overlay.active { display: flex; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Info Box */
        .info-box { 
            margin-top: 20px; 
            padding: 15px; 
            background: #e3f2fd; 
            border-radius: 8px;
            font-size: 14px;
        }
        .info-box code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p style="margin-top: 15px; color: #666;">Translating page...</p>
</div>

<div class="container">
    <h1>ğŸŒ Auto Language Translator</h1>
    
    <div class="status-bar detecting" id="statusBar">
        <span class="status-icon">ğŸ”</span>
        <span id="statusText">Detecting your location...</span>
    </div>

    <div class="language-selector">
        <label for="langSelect">ğŸŒ Language:</label>
        <select id="langSelect" onchange="translatePage(this.value)">
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="ur">ğŸ‡µğŸ‡° Urdu (Ø§Ø±Ø¯Ùˆ)</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</option>
            <option value="es">ğŸ‡ªğŸ‡¸ Spanish (EspaÃ±ol)</option>
            <option value="fr">ğŸ‡«ğŸ‡· French (FranÃ§ais)</option>
            <option value="de">ğŸ‡©ğŸ‡ª German (Deutsch)</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ Chinese (ä¸­æ–‡)</option>
            <option value="hi">ğŸ‡®ğŸ‡³ Hindi (à¤¹à¤¿à¤¨à¥à¤¦à¥€)</option>
            <option value="pt">ğŸ‡§ğŸ‡· Portuguese (PortuguÃªs)</option>
            <option value="ru">ğŸ‡·ğŸ‡º Russian (Ğ ÑƒÑÑĞºĞ¸Ğ¹)</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ Japanese (æ—¥æœ¬èª)</option>
            <option value="ko">ğŸ‡°ğŸ‡· Korean (í•œêµ­ì–´)</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italian (Italiano)</option>
            <option value="tr">ğŸ‡¹ğŸ‡· Turkish (TÃ¼rkÃ§e)</option>
            <option value="nl">ğŸ‡³ğŸ‡± Dutch (Nederlands)</option>
            <option value="pl">ğŸ‡µğŸ‡± Polish (Polski)</option>
        </select>
    </div>

    <div class="content">
        <h2 class="translatable" data-original="Welcome to Our Website">Welcome to Our Website</h2>
        <p class="translatable" data-original="This is sample content that will be automatically translated based on your location. Generative AI is transforming how we build modern web applications.">
            This is sample content that will be automatically translated based on your location. Generative AI is transforming how we build modern web applications.
        </p>
        <p class="translatable" data-original="As a developer, you need tools that are resilient to network interruptions. Our platform provides the best services for customers around the world.">
            As a developer, you need tools that are resilient to network interruptions. Our platform provides the best services for customers around the world.
        </p>
        <p class="translatable" data-original="Contact us today to learn more about what we can offer you. We're here to help you succeed!">
            Contact us today to learn more about what we can offer you. We're here to help you succeed!
        </p>
    </div>
    
    <div class="info-box" id="infoBox">
        <strong>â„¹ï¸ Detected Info:</strong><br>
        <span id="detectedInfo">Loading...</span>
    </div>
</div>

<script>
// Configuration - Using CORS-friendly APIs
const CONFIG = {
    // LibreTranslate public instance (CORS enabled)
    translationAPI: 'https://libretranslate.com/translate',
    // Alternative: Lingva Translate (Google Translate proxy, CORS enabled)
    lingvaAPI: 'https://lingva.ml/api/v1',
    // IP Geolocation (CORS enabled, free)
    geoAPI: 'https://api.ipgeolocation.io/ipgeo?apiKey=API_KEY', // Needs key
    // Alternative free geo APIs
    geoAPIFree: 'https://freeipapi.com/api/json'
};

// Country to language mapping
const COUNTRY_TO_LANG = {
    'PK': 'ur', 'SA': 'ar', 'AE': 'ar', 'EG': 'ar', 'ES': 'es',
    'MX': 'es', 'AR': 'es', 'FR': 'fr', 'DE': 'de', 'AT': 'de',
    'CH': 'de', 'CN': 'zh', 'TW': 'zh', 'IN': 'hi', 'BR': 'pt',
    'PT': 'pt', 'RU': 'ru', 'JP': 'ja', 'KR': 'ko', 'IT': 'it',
    'TR': 'tr', 'NL': 'nl', 'PL': 'pl', 'US': 'en', 'GB': 'en',
    'CA': 'en', 'AU': 'en', 'BD': 'bn', 'ID': 'id', 'TH': 'th',
    'VN': 'vi', 'PH': 'tl', 'MY': 'ms', 'IR': 'fa', 'IQ': 'ar'
};

// Lingva language codes (maps our codes to Lingva codes)
const LINGVA_LANG_MAP = {
    'ur': 'ur', 'ar': 'ar', 'es': 'es', 'fr': 'fr', 'de': 'de',
    'zh': 'zh', 'hi': 'hi', 'pt': 'pt', 'ru': 'ru', 'ja': 'ja',
    'ko': 'ko', 'it': 'it', 'tr': 'tr', 'nl': 'nl', 'pl': 'pl',
    'bn': 'bn', 'id': 'id', 'th': 'th', 'vi': 'vi', 'tl': 'tl',
    'ms': 'ms', 'fa': 'fa'
};

let currentLang = 'en';
let originalTexts = {};

// Store original texts on page load
document.querySelectorAll('.translatable').forEach((el, index) => {
    originalTexts[index] = el.getAttribute('data-original') || el.textContent;
});

// Detect location by IP and auto-translate
async function detectLocationAndTranslate() {
    const statusBar = document.getElementById('statusBar');
    const statusText = document.getElementById('statusText');
    const infoBox = document.getElementById('detectedInfo');
    
    try {
        // Try multiple geo APIs for reliability
        let data = null;
        
        // Try freeipapi.com first (CORS friendly)
        try {
            const response = await fetch('https://freeipapi.com/api/json', {
                method: 'GET'
            });
            if (response.ok) {
                data = await response.json();
                data = {
                    country_code: data.countryCode,
                    country_name: data.countryName,
                    city: data.cityName,
                    ip: data.ipAddress
                };
            }
        } catch(e) {
            console.log('freeipapi failed, trying alternative...');
        }
        
        // Fallback to ip-api.com (also CORS friendly)
        if (!data) {
            try {
                const response = await fetch('https://ip-api.com/json/?fields=status,country,countryCode,city,query');
                if (response.ok) {
                    const json = await response.json();
                    if (json.status === 'success') {
                        data = {
                            country_code: json.countryCode,
                            country_name: json.country,
                            city: json.city,
                            ip: json.query
                        };
                    }
                }
            } catch(e) {
                console.log('ip-api failed too');
            }
        }
        
        if (!data || !data.country_code) {
            throw new Error('Could not get location data');
        }
        
        const country = data.country_code;
        const city = data.city || 'Unknown';
        const countryName = data.country_name || country;
        
        // Get language for this country
        const detectedLang = COUNTRY_TO_LANG[country] || 'en';
        
        // Update info display
        infoBox.innerHTML = `
            <strong>IP:</strong> <code>${data.ip || 'Hidden'}</code> | 
            <strong>Location:</strong> ${city}, ${countryName} | 
            <strong>Auto-detected:</strong> ${getLanguageName(detectedLang)}
        `;
        
        // Update status
        statusBar.className = 'status-bar';
        statusText.textContent = `ğŸ“ Detected: ${countryName} â†’ Auto-selecting ${getLanguageName(detectedLang)}`;
        
        // Set dropdown and translate if not English
        document.getElementById('langSelect').value = detectedLang;
        
        if (detectedLang !== 'en') {
            await translatePage(detectedLang);
        } else {
            statusText.textContent = `ğŸ“ Location: ${countryName} - Page is in English (no translation needed)`;
        }
        
    } catch (error) {
        console.error('Geolocation error:', error);
        statusBar.className = 'status-bar error';
        statusText.textContent = 'âš ï¸ Could not detect location. Please select language manually.';
        infoBox.textContent = 'Location detection unavailable - please select your language from the dropdown above.';
    }
}

// Get language display name
function getLanguageName(code) {
    const names = {
        'en': 'English', 'ur': 'Urdu', 'ar': 'Arabic', 'es': 'Spanish',
        'fr': 'French', 'de': 'German', 'zh': 'Chinese', 'hi': 'Hindi',
        'pt': 'Portuguese', 'ru': 'Russian', 'ja': 'Japanese', 'ko': 'Korean',
        'it': 'Italian', 'tr': 'Turkish', 'nl': 'Dutch', 'pl': 'Polish',
        'bn': 'Bengali', 'id': 'Indonesian', 'th': 'Thai', 'vi': 'Vietnamese',
        'tl': 'Tagalog', 'ms': 'Malay', 'fa': 'Persian'
    };
    return names[code] || code;
}

// Translate page content
async function translatePage(targetLang) {
    if (targetLang === currentLang) return;
    
    const loadingOverlay = document.getElementById('loadingOverlay');
    const statusText = document.getElementById('statusText');
    
    // If going back to English, restore originals
    if (targetLang === 'en') {
        document.querySelectorAll('.translatable').forEach((el, index) => {
            el.textContent = originalTexts[index];
        });
        currentLang = 'en';
        statusText.textContent = 'âœ… Restored to English';
        return;
    }
    
    loadingOverlay.classList.add('active');
    statusText.textContent = `ğŸ”„ Translating to ${getLanguageName(targetLang)}...`;
    
    try {
        const elements = document.querySelectorAll('.translatable');
        
        for (let i = 0; i < elements.length; i++) {
            const el = elements[i];
            const text = originalTexts[i];
            
            // Call translation API
            const translated = await translateText(text, 'en', targetLang);
            if (translated) {
                el.textContent = translated;
            }
        }
        
        currentLang = targetLang;
        statusText.textContent = `âœ… Translated to ${getLanguageName(targetLang)}`;
        
    } catch (error) {
        console.error('Translation error:', error);
        statusText.textContent = 'âš ï¸ Translation service unavailable. Try again later.';
    } finally {
        loadingOverlay.classList.remove('active');
    }
}

// Translate using Lingva API (Google Translate proxy, CORS enabled)
async function translateText(text, sourceLang, targetLang) {
    // Use Lingva Translate - it's a CORS-friendly Google Translate proxy
    const lingvaLang = LINGVA_LANG_MAP[targetLang] || targetLang;
    
    // Try multiple Lingva instances for reliability
    const lingvaInstances = [
        'lingva.ml',
        'lingva.lunar.icu', 
        'translate.plausibility.cloud'
    ];
    
    for (const instance of lingvaInstances) {
        try {
            const url = `https://${instance}/api/v1/en/${lingvaLang}/${encodeURIComponent(text)}`;
            const response = await fetch(url);
            
            if (response.ok) {
                const data = await response.json();
                if (data.translation) {
                    return data.translation;
                }
            }
        } catch (e) {
            console.log(`Lingva instance ${instance} failed, trying next...`);
        }
    }
    
    // Fallback: Try MyMemory with JSONP-style workaround
    try {
        const mmUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${targetLang}&de=your@email.com`;
        const response = await fetch(mmUrl);
        const data = await response.json();
        
        if (data.responseStatus === 200 && data.responseData) {
            return data.responseData.translatedText;
        }
    } catch (e) {
        console.log('MyMemory also failed');
    }
    
    throw new Error('All translation services failed');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    detectLocationAndTranslate();
});
</script>

</body>
</html>
