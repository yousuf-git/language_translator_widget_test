<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Language Translator</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
        }
        h1 { color: #333; margin-bottom: 10px; }
        
        /* Status Bar */
        .status-bar {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-bar.detecting { background: #fff3e0; border-color: #ff9800; }
        .status-bar.error { background: #ffebee; border-color: #f44336; }
        .status-icon { font-size: 20px; }
        
        /* Language Selector */
        .language-selector { 
            margin: 20px 0; 
            padding: 20px; 
            background: #f5f5f5; 
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .language-selector label {
            font-weight: bold;
            font-size: 16px;
        }
        .language-selector select {
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 6px;
            border: 2px solid #ddd;
            cursor: pointer;
            min-width: 200px;
        }
        .language-selector select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        /* Content Area */
        .content {
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin: 20px 0;
        }
        .content h2 { margin-top: 0; color: #333; }
        .translatable { line-height: 1.8; }
        
        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }
        .loading-overlay.active { display: flex; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Info Box */
        .info-box { 
            margin-top: 20px; 
            padding: 15px; 
            background: #e3f2fd; 
            border-radius: 8px;
            font-size: 14px;
        }
        .info-box code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p style="margin-top: 15px; color: #666;">Translating page...</p>
</div>

<div class="container">
    <h1>ğŸŒ Auto Language Translator</h1>
    
    <div class="status-bar detecting" id="statusBar">
        <span class="status-icon">ğŸ”</span>
        <span id="statusText">Detecting your location...</span>
    </div>

    <div class="language-selector">
        <label for="langSelect">ğŸŒ Language:</label>
        <select id="langSelect" onchange="translatePage(this.value)">
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="ur">ğŸ‡µğŸ‡° Urdu (Ø§Ø±Ø¯Ùˆ)</option>
            <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</option>
            <option value="es">ğŸ‡ªğŸ‡¸ Spanish (EspaÃ±ol)</option>
            <option value="fr">ğŸ‡«ğŸ‡· French (FranÃ§ais)</option>
            <option value="de">ğŸ‡©ğŸ‡ª German (Deutsch)</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ Chinese (ä¸­æ–‡)</option>
            <option value="hi">ğŸ‡®ğŸ‡³ Hindi (à¤¹à¤¿à¤¨à¥à¤¦à¥€)</option>
            <option value="pt">ğŸ‡§ğŸ‡· Portuguese (PortuguÃªs)</option>
            <option value="ru">ğŸ‡·ğŸ‡º Russian (Ğ ÑƒÑÑĞºĞ¸Ğ¹)</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ Japanese (æ—¥æœ¬èª)</option>
            <option value="ko">ğŸ‡°ğŸ‡· Korean (í•œêµ­ì–´)</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italian (Italiano)</option>
            <option value="tr">ğŸ‡¹ğŸ‡· Turkish (TÃ¼rkÃ§e)</option>
            <option value="nl">ğŸ‡³ğŸ‡± Dutch (Nederlands)</option>
            <option value="pl">ğŸ‡µğŸ‡± Polish (Polski)</option>
        </select>
    </div>

    <div class="content">
        <h2 class="translatable" data-original="Welcome to Our Website">Welcome to Our Website</h2>
        <p class="translatable" data-original="This is sample content that will be automatically translated based on your location. Generative AI is transforming how we build modern web applications.">
            This is sample content that will be automatically translated based on your location. Generative AI is transforming how we build modern web applications.
        </p>
        <p class="translatable" data-original="As a developer, you need tools that are resilient to network interruptions. Our platform provides the best services for customers around the world.">
            As a developer, you need tools that are resilient to network interruptions. Our platform provides the best services for customers around the world.
        </p>
        <p class="translatable" data-original="Contact us today to learn more about what we can offer you. We're here to help you succeed!">
            Contact us today to learn more about what we can offer you. We're here to help you succeed!
        </p>
    </div>
    
    <div class="info-box" id="infoBox">
        <strong>â„¹ï¸ Detected Info:</strong><br>
        <span id="detectedInfo">Loading...</span>
    </div>
</div>

<script>
// Country to language mapping
const COUNTRY_TO_LANG = {
    'PK': 'ur', 'SA': 'ar', 'AE': 'ar', 'EG': 'ar', 'ES': 'es',
    'MX': 'es', 'AR': 'es', 'FR': 'fr', 'DE': 'de', 'AT': 'de',
    'CH': 'de', 'CN': 'zh', 'TW': 'zh', 'IN': 'hi', 'BR': 'pt',
    'PT': 'pt', 'RU': 'ru', 'JP': 'ja', 'KR': 'ko', 'IT': 'it',
    'TR': 'tr', 'NL': 'nl', 'PL': 'pl', 'US': 'en', 'GB': 'en',
    'CA': 'en', 'AU': 'en', 'BD': 'bn', 'ID': 'id', 'TH': 'th',
    'VN': 'vi', 'PH': 'tl', 'MY': 'ms', 'IR': 'fa', 'IQ': 'ar',
    'AF': 'fa', 'CL': 'es', 'CO': 'es', 'PE': 'es', 'VE': 'es',
    'SE': 'sv', 'NO': 'no', 'DK': 'da', 'FI': 'fi', 'GR': 'el',
    'IL': 'he', 'UA': 'uk', 'CZ': 'cs', 'HU': 'hu', 'RO': 'ro'
};

// Browser locale to language mapping (for navigator.language)
const LOCALE_TO_LANG = {
    'en': 'en', 'en-US': 'en', 'en-GB': 'en', 'en-AU': 'en',
    'ur': 'ur', 'ur-PK': 'ur',
    'ar': 'ar', 'ar-SA': 'ar', 'ar-AE': 'ar', 'ar-EG': 'ar',
    'es': 'es', 'es-ES': 'es', 'es-MX': 'es', 'es-AR': 'es',
    'fr': 'fr', 'fr-FR': 'fr', 'fr-CA': 'fr',
    'de': 'de', 'de-DE': 'de', 'de-AT': 'de', 'de-CH': 'de',
    'zh': 'zh', 'zh-CN': 'zh', 'zh-TW': 'zh', 'zh-Hans': 'zh', 'zh-Hant': 'zh',
    'hi': 'hi', 'hi-IN': 'hi',
    'pt': 'pt', 'pt-BR': 'pt', 'pt-PT': 'pt',
    'ru': 'ru', 'ru-RU': 'ru',
    'ja': 'ja', 'ja-JP': 'ja',
    'ko': 'ko', 'ko-KR': 'ko',
    'it': 'it', 'it-IT': 'it',
    'tr': 'tr', 'tr-TR': 'tr',
    'nl': 'nl', 'nl-NL': 'nl',
    'pl': 'pl', 'pl-PL': 'pl',
    'bn': 'bn', 'bn-BD': 'bn', 'bn-IN': 'bn',
    'id': 'id', 'id-ID': 'id',
    'th': 'th', 'th-TH': 'th',
    'vi': 'vi', 'vi-VN': 'vi',
    'fa': 'fa', 'fa-IR': 'fa',
    'sv': 'sv', 'sv-SE': 'sv',
    'no': 'no', 'nb': 'no', 'nn': 'no',
    'da': 'da', 'da-DK': 'da',
    'fi': 'fi', 'fi-FI': 'fi',
    'el': 'el', 'el-GR': 'el',
    'he': 'he', 'he-IL': 'he',
    'uk': 'uk', 'uk-UA': 'uk',
    'cs': 'cs', 'cs-CZ': 'cs',
    'hu': 'hu', 'hu-HU': 'hu',
    'ro': 'ro', 'ro-RO': 'ro'
};

// Lingva language codes
const LINGVA_LANG_MAP = {
    'ur': 'ur', 'ar': 'ar', 'es': 'es', 'fr': 'fr', 'de': 'de',
    'zh': 'zh', 'hi': 'hi', 'pt': 'pt', 'ru': 'ru', 'ja': 'ja',
    'ko': 'ko', 'it': 'it', 'tr': 'tr', 'nl': 'nl', 'pl': 'pl',
    'bn': 'bn', 'id': 'id', 'th': 'th', 'vi': 'vi', 'tl': 'tl',
    'ms': 'ms', 'fa': 'fa', 'sv': 'sv', 'no': 'no', 'da': 'da',
    'fi': 'fi', 'el': 'el', 'he': 'iw', 'uk': 'uk', 'cs': 'cs',
    'hu': 'hu', 'ro': 'ro'
};

let currentLang = 'en';
let originalTexts = {};

// Store original texts on page load
document.querySelectorAll('.translatable').forEach((el, index) => {
    originalTexts[index] = el.getAttribute('data-original') || el.textContent;
});

// ========== BROWSER-BASED DETECTION (NO EXTERNAL API) ==========

// Method 1: Get language from browser's navigator.language
function getBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage || navigator.browserLanguage;
    console.log('Browser language:', browserLang);
    
    // Direct match
    if (LOCALE_TO_LANG[browserLang]) {
        return { lang: LOCALE_TO_LANG[browserLang], method: 'browser-locale-exact' };
    }
    
    // Try base language (e.g., "en" from "en-US")
    const baseLang = browserLang.split('-')[0];
    if (LOCALE_TO_LANG[baseLang]) {
        return { lang: LOCALE_TO_LANG[baseLang], method: 'browser-locale-base' };
    }
    
    return null;
}

// Method 2: Get region from Intl API (timezone-based)
function getRegionFromTimezone() {
    try {
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        console.log('Timezone:', timezone);
        
        // Map timezones to countries
        const tzToCountry = {
            // Asia
            'Asia/Karachi': 'PK', 'Asia/Lahore': 'PK',
            'Asia/Riyadh': 'SA', 'Asia/Dubai': 'AE', 'Asia/Cairo': 'EG',
            'Asia/Kolkata': 'IN', 'Asia/Mumbai': 'IN', 'Asia/Delhi': 'IN',
            'Asia/Shanghai': 'CN', 'Asia/Beijing': 'CN', 'Asia/Hong_Kong': 'CN',
            'Asia/Taipei': 'TW',
            'Asia/Tokyo': 'JP',
            'Asia/Seoul': 'KR',
            'Asia/Bangkok': 'TH',
            'Asia/Jakarta': 'ID',
            'Asia/Ho_Chi_Minh': 'VN', 'Asia/Hanoi': 'VN',
            'Asia/Manila': 'PH',
            'Asia/Kuala_Lumpur': 'MY', 'Asia/Singapore': 'SG',
            'Asia/Tehran': 'IR',
            'Asia/Baghdad': 'IQ',
            'Asia/Dhaka': 'BD',
            'Asia/Kabul': 'AF',
            'Asia/Jerusalem': 'IL', 'Asia/Tel_Aviv': 'IL',
            'Asia/Istanbul': 'TR',
            
            // Europe
            'Europe/London': 'GB', 'Europe/Dublin': 'GB',
            'Europe/Paris': 'FR',
            'Europe/Berlin': 'DE', 'Europe/Munich': 'DE',
            'Europe/Vienna': 'AT',
            'Europe/Zurich': 'CH',
            'Europe/Rome': 'IT', 'Europe/Milan': 'IT',
            'Europe/Madrid': 'ES', 'Europe/Barcelona': 'ES',
            'Europe/Lisbon': 'PT',
            'Europe/Amsterdam': 'NL',
            'Europe/Brussels': 'BE',
            'Europe/Warsaw': 'PL',
            'Europe/Moscow': 'RU', 'Europe/St_Petersburg': 'RU',
            'Europe/Kiev': 'UA', 'Europe/Kyiv': 'UA',
            'Europe/Prague': 'CZ',
            'Europe/Budapest': 'HU',
            'Europe/Bucharest': 'RO',
            'Europe/Athens': 'GR',
            'Europe/Stockholm': 'SE',
            'Europe/Oslo': 'NO',
            'Europe/Copenhagen': 'DK',
            'Europe/Helsinki': 'FI',
            
            // Americas
            'America/New_York': 'US', 'America/Los_Angeles': 'US', 'America/Chicago': 'US',
            'America/Toronto': 'CA', 'America/Vancouver': 'CA',
            'America/Mexico_City': 'MX',
            'America/Sao_Paulo': 'BR', 'America/Rio_de_Janeiro': 'BR',
            'America/Buenos_Aires': 'AR',
            'America/Santiago': 'CL',
            'America/Lima': 'PE',
            'America/Bogota': 'CO',
            'America/Caracas': 'VE',
            
            // Oceania
            'Australia/Sydney': 'AU', 'Australia/Melbourne': 'AU',
            'Pacific/Auckland': 'NZ'
        };
        
        if (tzToCountry[timezone]) {
            const country = tzToCountry[timezone];
            const lang = COUNTRY_TO_LANG[country] || 'en';
            return { lang, country, timezone, method: 'timezone' };
        }
        
        // Try to extract region from timezone (e.g., "Asia/Karachi" -> might be Pakistan)
        const parts = timezone.split('/');
        if (parts.length === 2) {
            return { timezone, region: parts[0], city: parts[1], method: 'timezone-partial' };
        }
    } catch (e) {
        console.log('Timezone detection failed:', e);
    }
    return null;
}

// Method 3: Get region from Intl.Locale (modern browsers)
function getRegionFromIntlLocale() {
    try {
        if (typeof Intl.Locale !== 'undefined') {
            const locale = new Intl.Locale(navigator.language);
            const region = locale.region;
            console.log('Intl.Locale region:', region);
            
            if (region && COUNTRY_TO_LANG[region]) {
                return { lang: COUNTRY_TO_LANG[region], country: region, method: 'intl-locale' };
            }
        }
    } catch (e) {
        console.log('Intl.Locale not supported:', e);
    }
    return null;
}

// Main detection function - tries browser methods first, then external APIs
async function detectLocationAndTranslate() {
    const statusBar = document.getElementById('statusBar');
    const statusText = document.getElementById('statusText');
    const infoBox = document.getElementById('detectedInfo');
    
    let detectedLang = 'en';
    let detectionMethod = '';
    let locationInfo = '';
    
    // ===== STEP 1: Try browser-based detection (instant, no API calls) =====
    statusText.textContent = 'ğŸ” Detecting your language...';
    
    // Try Intl.Locale first (most accurate for region)
    let result = getRegionFromIntlLocale();
    if (result && result.lang && result.lang !== 'en') {
        detectedLang = result.lang;
        detectionMethod = result.method;
        locationInfo = `Region: ${result.country}`;
    }
    
    // Try timezone-based detection
    if (detectedLang === 'en') {
        result = getRegionFromTimezone();
        if (result && result.lang && result.lang !== 'en') {
            detectedLang = result.lang;
            detectionMethod = result.method;
            locationInfo = `Timezone: ${result.timezone || result.city}`;
        }
    }
    
    // Try browser language
    if (detectedLang === 'en') {
        result = getBrowserLanguage();
        if (result && result.lang && result.lang !== 'en') {
            detectedLang = result.lang;
            detectionMethod = result.method;
            locationInfo = `Browser: ${navigator.language}`;
        }
    }
    
    // ===== STEP 2: If browser detection found non-English, use it =====
    if (detectedLang !== 'en') {
        console.log(`Detected ${detectedLang} via ${detectionMethod}`);
        
        infoBox.innerHTML = `
            <strong>Detection:</strong> ${detectionMethod} | 
            <strong>${locationInfo}</strong> | 
            <strong>Language:</strong> ${getLanguageName(detectedLang)}
        `;
        
        statusBar.className = 'status-bar';
        statusText.textContent = `ğŸ“ Detected: ${getLanguageName(detectedLang)} (via ${detectionMethod})`;
        
        document.getElementById('langSelect').value = detectedLang;
        await translatePage(detectedLang);
        return;
    }
    
    // ===== STEP 3: Fallback to external IP API if browser detection returned English =====
    // (User might be English speaker OR browser detection didn't work well)
    statusText.textContent = 'ğŸ” Checking location via IP...';
    
    try {
        let ipData = null;
        
        // Try ip-api.com (CORS friendly, no key needed)
        try {
            const response = await fetch('https://ip-api.com/json/?fields=status,country,countryCode,city,query', {
                signal: AbortSignal.timeout(5000) // 5 second timeout
            });
            if (response.ok) {
                const json = await response.json();
                if (json.status === 'success') {
                    ipData = {
                        country_code: json.countryCode,
                        country_name: json.country,
                        city: json.city,
                        ip: json.query
                    };
                }
            }
        } catch(e) {
            console.log('ip-api.com failed:', e.message);
        }
        
        // Fallback: freeipapi.com
        if (!ipData) {
            try {
                const response = await fetch('https://freeipapi.com/api/json', {
                    signal: AbortSignal.timeout(5000)
                });
                if (response.ok) {
                    const data = await response.json();
                    ipData = {
                        country_code: data.countryCode,
                        country_name: data.countryName,
                        city: data.cityName,
                        ip: data.ipAddress
                    };
                }
            } catch(e) {
                console.log('freeipapi.com failed:', e.message);
            }
        }
        
        if (ipData && ipData.country_code) {
            const ipLang = COUNTRY_TO_LANG[ipData.country_code] || 'en';
            
            infoBox.innerHTML = `
                <strong>IP:</strong> <code>${ipData.ip || 'Hidden'}</code> | 
                <strong>Location:</strong> ${ipData.city || 'Unknown'}, ${ipData.country_name} | 
                <strong>Language:</strong> ${getLanguageName(ipLang)}
            `;
            
            statusBar.className = 'status-bar';
            
            if (ipLang !== 'en') {
                statusText.textContent = `ğŸ“ Location: ${ipData.country_name} â†’ ${getLanguageName(ipLang)}`;
                document.getElementById('langSelect').value = ipLang;
                await translatePage(ipLang);
            } else {
                statusText.textContent = `ğŸ“ Location: ${ipData.country_name} - Page is in English`;
            }
            return;
        }
    } catch (error) {
        console.error('IP geolocation error:', error);
    }
    
    // ===== STEP 4: All detection failed, show manual selection =====
    statusBar.className = 'status-bar';
    statusText.textContent = `ğŸ“ Browser language: ${navigator.language} - Page is in English`;
    infoBox.innerHTML = `
        <strong>Browser:</strong> ${navigator.language} | 
        <strong>Timezone:</strong> ${Intl.DateTimeFormat().resolvedOptions().timeZone} |
        Select your language from the dropdown if needed.
    `;
}

// Get language display name
function getLanguageName(code) {
    const names = {
        'en': 'English', 'ur': 'Urdu', 'ar': 'Arabic', 'es': 'Spanish',
        'fr': 'French', 'de': 'German', 'zh': 'Chinese', 'hi': 'Hindi',
        'pt': 'Portuguese', 'ru': 'Russian', 'ja': 'Japanese', 'ko': 'Korean',
        'it': 'Italian', 'tr': 'Turkish', 'nl': 'Dutch', 'pl': 'Polish',
        'bn': 'Bengali', 'id': 'Indonesian', 'th': 'Thai', 'vi': 'Vietnamese',
        'tl': 'Tagalog', 'ms': 'Malay', 'fa': 'Persian'
    };
    return names[code] || code;
}

// Translate page content
async function translatePage(targetLang) {
    if (targetLang === currentLang) return;
    
    const loadingOverlay = document.getElementById('loadingOverlay');
    const statusText = document.getElementById('statusText');
    
    // If going back to English, restore originals
    if (targetLang === 'en') {
        document.querySelectorAll('.translatable').forEach((el, index) => {
            el.textContent = originalTexts[index];
        });
        currentLang = 'en';
        statusText.textContent = 'âœ… Restored to English';
        return;
    }
    
    loadingOverlay.classList.add('active');
    statusText.textContent = `ğŸ”„ Translating to ${getLanguageName(targetLang)}...`;
    
    try {
        const elements = document.querySelectorAll('.translatable');
        
        for (let i = 0; i < elements.length; i++) {
            const el = elements[i];
            const text = originalTexts[i];
            
            // Call translation API
            const translated = await translateText(text, 'en', targetLang);
            if (translated) {
                el.textContent = translated;
            }
        }
        
        currentLang = targetLang;
        statusText.textContent = `âœ… Translated to ${getLanguageName(targetLang)}`;
        
    } catch (error) {
        console.error('Translation error:', error);
        statusText.textContent = 'âš ï¸ Translation service unavailable. Try again later.';
    } finally {
        loadingOverlay.classList.remove('active');
    }
}

// Translate using Lingva API (Google Translate proxy, CORS enabled)
async function translateText(text, sourceLang, targetLang) {
    // Use Lingva Translate - it's a CORS-friendly Google Translate proxy
    const lingvaLang = LINGVA_LANG_MAP[targetLang] || targetLang;
    
    // Try multiple Lingva instances for reliability
    const lingvaInstances = [
        'lingva.ml',
        'lingva.lunar.icu', 
        'translate.plausibility.cloud'
    ];
    
    for (const instance of lingvaInstances) {
        try {
            const url = `https://${instance}/api/v1/en/${lingvaLang}/${encodeURIComponent(text)}`;
            const response = await fetch(url);
            
            if (response.ok) {
                const data = await response.json();
                if (data.translation) {
                    return data.translation;
                }
            }
        } catch (e) {
            console.log(`Lingva instance ${instance} failed, trying next...`);
        }
    }
    
    // Fallback: Try MyMemory with JSONP-style workaround
    try {
        const mmUrl = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${targetLang}&de=your@email.com`;
        const response = await fetch(mmUrl);
        const data = await response.json();
        
        if (data.responseStatus === 200 && data.responseData) {
            return data.responseData.translatedText;
        }
    } catch (e) {
        console.log('MyMemory also failed');
    }
    
    throw new Error('All translation services failed');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    detectLocationAndTranslate();
});
</script>

</body>
</html>
